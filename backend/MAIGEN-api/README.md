API模块，处理前端请求，操作数据库

# 业务场景

## 平台概述
MAIGEN (Multi-Agent Intelligent Generation) 是一个为OI/ICPC参赛者和出题人建立的自动化数据生成平台，用于快速生成高强度、边界覆盖全的测试数据。平台采用无状态计算 + 编排器模式 + 多智能体协同的核心理念，构建高可用、可水平扩展的智能化算法数据生成系统。

## 核心业务场景

### 1. 用户注册与邀请流程（用户A & 新用户）

#### 场景描述：用户A邀请新用户注册，双方获得积分奖励

**步骤1：用户A获取邀请码**
- 用户A登录平台
- 进入「个人中心」→「邀请好友」页面
- 系统在注册时生成唯一邀请码：「MAIGEN2024」

**步骤2：新用户通过邀请码注册**
- 新用户访问平台注册页面
- 输入邮箱地址：「newuser@example.com」
- 点击「获取验证码」，系统发送验证码到邮箱
- 输入验证码、设置密码
- 在「邀请码」字段填写：「MAIGEN2024」
- 点击「注册」按钮

**步骤3：系统处理注册并发放奖励**
- 系统验证邮箱验证码
- 系统创建新用户账号
- 系统为新用户发放注册奖励：50积分
- 系统为新用户发放邀请奖励：5积分
- 系统为用户A发放邀请奖励：20积分

**步骤4：用户A和新用户查看积分奖励**
- 用户A在「个人中心」→「积分记录」中看到「邀请好友奖励 +20积分」
- 新用户在「个人中心」→「积分记录」中看到「注册奖励 +50积分」和「被邀请奖励 +5积分」

### 2. 任务创建与执行流程（单个用户）

#### 场景描述：用户配置任务参数并执行数据生成

**步骤1：用户登录平台**
- 用户通过账号密码登录平台

**步骤2：用户配置任务参数**
- 进入「任务创建」页面
- 填写任务标题：「二分查找算法测试数据」
- 输入题目信息：包含题目描述、输入输出格式、数据范围、样例
- 上传标准程序：C++语言实现标准程序
- 设置期望的数据构造策略：覆盖基础随机、边界极值、特殊结构等类型，可以自由分配每种类型占多少个测试点，但总数不能超过20个，不能低于1个，每个构造策略都是系统预设，有一个对应的ID。
- 提交任务，后端接收到用户请求，把任务更新到数据库中，状态为等待中（具体状态看实际的枚举类），把任务信息更新到缓存中，把任务ID放入【等待分析】消息队列（在MAIGEN-analysis端消费），由多个队列实例竞争消费。
- 积分消耗：用户提交任务后，系统会消耗用户5积分。

**步骤3：用户监控任务进度**
- 用户在「任务列表」页面查看历史任务
- 点击其中一个任务，进入任务详情页，实时查看任务状态：待分析 → 分析中 → 生成中 → 验证中 → 完成
- 实时查看进度条和状态更新

**步骤4：系统执行任务（具体代码由MAIGEN-analysis实现）**
- 从【等待分析】消息队列取出任务ID，根据任务ID从缓存中取出任务信息。
- 题目分析AI分析题目约束条件
- 策略构造AI制定数据生成策略
- 代码生成AI编写数据生成代码
- 代码评审AI评审生成的代码
- 将生成的代码放入缓存，把任务ID放入【等待执行】消息队列（在MAIGEN-sandbox端消费），由多个队列实例竞争消费。
- 把任务ID放入【分析完成】消息队列（在MAIGEN-api端消费），由多个队列实例竞争消费，更新任务状态到数据库和缓存。

**步骤5：系统执行任务（具体代码由MAIGEN-sandbox实现）**
- 从【等待执行】消息队列取出任务ID，根据任务ID从缓存中取出生成代码。
- 系统执行数据生成和验证
- 将生成的数据打包成ZIP上传到文件系统，并把任务ID放入【生成完成】消息队列（在MAIGEN-api端消费），由多个队列实例竞争消费，更新任务状态到数据库和缓存。

### 3. 数据导出流程（单个用户）

#### 场景描述：用户导出已生成的测试数据

**步骤1：用户进入任务详情页面**
- 用户在「任务列表」页面选择已完成的任务
- 点击任务详情查看生成的测试数据

**步骤2：用户导出测试数据**
- 用户点击「下载」按钮
- 用户下载并使用测试数据


### 4. 社区分享流程（用户A & 管理员）

#### 场景描述：用户A分享已生成的任务到社区，管理员审核

**步骤1：用户A进入任务详情页面**
- 用户A在「任务列表」页面选择已完成的任务
- 点击任务详情查看生成的测试数据

**步骤2：用户A分享内容到社区**
- 用户A在任务详情页面点击「分享到社区」按钮
- 填写分享描述和下载所需积分N
- 提交分享申请
- 系统将分享内容提交给管理员审核

**步骤3：管理员审核分享内容**
- 管理员登录管理后台
- 进入「社区管理」页面
- 查看待审核的分享内容
- 审核通过用户A的分享
- 系统通知用户A分享已通过审核

**步骤4：用户A查看分享状态**
- 用户A在「个人中心」→「我的分享」中查看分享状态
- 确认分享已通过审核并在社区中可见

### 5. 社区浏览与下载流程（用户B & 用户A）

#### 场景描述：用户B浏览社区并下载用户A分享的内容

**步骤1：用户B浏览社区内容**
- 用户B登录平台
- 进入「社区」页面
- 可通过时间、点赞量排序
- 发现用户A分享的「二分查找算法测试数据」，里面包含用户A创建任务时的完整题目信息，但是下载链接是隐藏的
- 给内容点赞

**步骤2：用户B下载社区内容**
- 用户B点击「下载」按钮
- 系统提示下载需要消耗N积分
- 用户B确认下载
- 系统扣除用户B N积分
- 系统奖励用户A N/2积分
- 用户B获得ZIP格式的测试数据文件下载权

**步骤3：用户A和用户B查看积分变动**
- 用户A在「个人中心」→「积分记录」中看到「分享被下载奖励 +N/2积分」
- 用户B在「个人中心」→「积分记录」中看到「下载社区内容 -N积分」

### 6. 积分管理流程（单个用户）

#### 场景描述：用户查看和管理自己的积分

**步骤1：用户查看积分余额**
- 用户登录平台
- 进入「个人中心」页面
- 查看当前积分余额

**步骤2：用户查看积分记录**
- 用户点击「积分记录」
- 查看详细的积分获取与消耗历史
- 包括注册奖励、邀请奖励、分享被下载奖励、生成数据消耗、下载社区内容消耗等

**步骤3：用户了解积分规则**
- 用户查看积分规则说明
- 了解积分获取方式：注册奖励50积分、邀请好友奖励20积分、被邀请奖励5积分、分享被下载奖励N/2积分/次
- 了解积分消耗方式：生成数据5积分/次、下载社区数据N积分/次

## 开发计划场景
- **第一阶段**：用户模块（注册、登录、个人信息管理、权限管理基础功能）
- **第二阶段**：任务核心流程（任务配置管理、AI分析和数据生成、进度监控和数据下载）
- **第三阶段**：积分系统（积分获取和消耗、积分记录管理）
- **第四阶段**：后台管理（系统配置、数据统计与分析）
- **第五阶段**：社区功能（内容分享和审核、积分奖励机制）
