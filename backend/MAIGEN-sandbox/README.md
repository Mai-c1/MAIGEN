沙箱执行模块，负责从消息队列中获取任务，执行任务，将测试数据打包成zip文件，上传到文件存储服务。

# 业务场景

## 模块概述
MAIGEN-sandbox 是 MAIGEN 平台的沙箱执行模块，负责从消息队列中获取待执行的任务，通过调用 go-judge 的 HTTP 接口执行数据生成代码，接收生成的测试数据，将数据打包成 ZIP 文件，并上传到文件存储服务。该模块采用异步处理模式，确保任务执行的可靠性和可扩展性。

## 核心业务场景

### 1. 任务接收场景

#### 场景描述：从消息队列获取待执行的任务

**步骤1：监听消息队列**
- 从【等待执行】消息队列中取出任务ID
- 多个队列实例竞争消费，确保负载均衡

**步骤2：获取任务信息**
- 根据任务ID从缓存中获取完整的任务信息
- 验证任务信息的完整性和有效性
- 检查任务状态是否为待执行状态

**步骤3：准备执行环境**
- 提取任务中的数据生成代码
- 提取任务中的标准程序代码
- 准备执行所需的配置参数

### 2. HTTP请求发送场景

#### 场景描述：向go-judge发送HTTP请求执行数据生成代码

**步骤1：构造HTTP请求**
- 根据go-judge的API规范构造HTTP请求
- 设置请求头信息，包括Content-Type、Authorization等
- 将数据生成代码作为请求体发送

**步骤2：发送HTTP请求**
- 调用go-judge的HTTP接口执行数据生成代码
- 设置合理的超时时间（单个任务最大30分钟）
- 处理网络异常和请求失败情况

**步骤3：监控执行状态**
- 轮询go-judge的执行状态接口
- 实时跟踪任务执行进度
- 记录执行过程中的关键信息

### 3. 数据生成场景

#### 场景描述：接收go-judge返回的测试数据

**步骤1：接收执行结果**
- 接收go-judge返回的执行结果
- 解析返回的测试数据内容
- 验证数据格式的正确性

**步骤2：数据验证**
- 使用标准程序验证生成的测试数据
- 检查每个测试点的输入输出是否匹配
- 记录验证结果和异常情况

**步骤3：数据整理**
- 将验证通过的测试数据整理成标准格式
- 按照测试点编号组织数据
- 准备后续的打包操作

### 4. 文件打包场景

#### 场景描述：将测试数据打包成ZIP文件

**步骤1：准备文件结构**
- 按照命名规则创建输入输出文件：input1.in, output1.out
- 为每个测试点生成对应的输入输出文件对
- 确保文件数量与用户设置的测试点数量一致

**步骤2：创建ZIP压缩包**
- 使用Java的ZIP工具类创建压缩包
- 将所有输入输出文件添加到ZIP包中
- 设置合理的压缩级别，平衡压缩率和速度

**步骤3：验证ZIP文件**
- 验证ZIP文件的完整性
- 检查ZIP包中是否包含所有必要的文件
- 确保ZIP文件可以正常解压

### 5. 文件上传场景

#### 场景描述：将ZIP文件上传到文件存储服务

**步骤1：连接文件存储服务**
- 根据配置连接文件存储服务
- 验证连接状态和权限
- 准备上传所需的认证信息

**步骤2：上传ZIP文件**
- 将ZIP文件上传到文件存储服务
- 生成唯一的文件访问路径
- 记录上传结果和文件路径

**步骤3：更新任务状态**
- 将任务ID放入【生成完成】消息队列（由MAIGEN-api端消费）
- 更新缓存中的任务状态和文件路径信息
- 清理临时文件，释放系统资源

## 开发计划场景
- **第一阶段**：消息队列集成（接收任务、发送结果）
- **第二阶段**：HTTP请求模块（go-judge接口调用、状态监控）
- **第三阶段**：数据生成与验证（接收数据、标准程序验证）
- **第四阶段**：文件处理功能（ZIP打包、文件命名）
- **第五阶段**：文件上传功能（存储服务集成、路径管理）